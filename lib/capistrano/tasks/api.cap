namespace :deploy do

  namespace :apidocs do

    desc 'Produce API documentation'
    task :generate => [:set_rails_env] do
      on roles(:app) do
        within release_path do
          with rails_env: fetch(:rails_env) do
            execute :bundle, :exec, :rake, 'apidocs:generate'
          end
        end
      end
    end

    after 'deploy:updated', 'deploy:apidocs:generate'
  end
end
